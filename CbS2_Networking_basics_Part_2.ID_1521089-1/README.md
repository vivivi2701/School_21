# Основы сетей. Часть 2 — «Прикладные подарки»
Аннотация: Данный проект включает в себя продолжение разбора основ сетей, модели OSI/TCP/IP на примере работы в среде GNS3. А также статической маршрутизации, TCP/UDP, DNS, NTP, Telnet, SSH, DHCP.

## Содержание
1. [Chapter I](#chapter-i) \
   1.1. [Рекомендации к проекту](#рекомендации-к-проекту)
2. [Chapter II](#chapter-ii) \
   2.1. [Прикладные протоколы](#прикладные-протоколы)
3. [Chapter III](#chapter-iii) \
   3.1. [Задание 1. Статическая маршрутизация](#задание-1-статическая-маршрутизация)    
   3.2. [Задание 2. NTP](#задание-2-ntp) \
   3.3. [Задание 3. DNS](#задание-3-dns) \
   3.4. [Задание 4. DHCP](#задание-4-dhcp) \
   3.5. [Задание 5. SSH](#задание-5-ssh) 


### Введение

>За окном виднелся уже успевший залежаться снег, в котором еще утром резвились дети. Все с нетерпением ждали Нового года, до которого остались считаные дни. Николай не разделял всеобщего возбуждения и в летаргическом сне провел уже вторые сутки. О новогоднем настроении не было и речи — его интересовал только телевизор и упорная муха, которая всеми силами пыталась пристроиться у него на голове. И все бы ничего, но проблема была в том, что Николай — главный Дед Мороз страны. Вот только оленей забрали приставы за неуплату налогов, сани он продал на запчасти, а снегурочка ушла к Санта-Клаусу. Другими словами, смысл жизни для Николая был потерян. Он решил, что подарки детям подарят родители, пока он будет на заслуженном отдыхе.

## Chapter I
### Рекомендации к проекту
Как учиться в «Школе 21»:  
- На протяжении всего курса ты будешь самостоятельно добывать информацию. Пользуйся всеми доступными средствами поиска информации, к примеру, Google и GigaChat. Будь внимателен к источникам информации: проверяй, думай, анализируй, сравнивай. 
- Взаимообучение (P2P, Peer-to-Peer) — это процесс, при котором учащиеся обмениваются знаниями и опытом, выступая одновременно в роли учителей и учеников. Этот подход позволяет учиться не только у преподавателя, но и друг у друга, что способствует более глубокому пониманию материала.
- Не стесняйся просить помощи: вокруг тебя такие же пиры, которые тоже проходят этот путь впервые. Не бойся откликаться на просьбы о помощи. Твой опыт ценен и полезен, смело делись им с другими участниками. 
- Не списывай, а если пользуешься помощью — всегда разбирайся до конца, почему, как и зачем. Иначе твое обучение не будет иметь никакого смысла. 
- Если ты на чем-то застрял и кажется, что ты уже все перепробовал, но все равно непонятно, куда идти, — просто передохни! Поверь, этот совет помогал многим экспертам по КБ в их работе. Проветрись, перезагрузи голову и, возможно, в следующий раз тебе наконец придет нужное решение!
- Важен не только результат обучения, но и сам процесс. Нужно не просто решить задачу, а понять, КАК ее решить.

Как работать с проектом: 
- Перед выполнением проект необходимо склонировать с GitLab в одноименный репозиторий.
- Все файлы с кодом необходимо создавать в папке src склонированного репозитория.
- После клонирования проекта необходимо создать ветку `develop` и вести разработку в ней. После этого пушить в GitLab также нужно ветку `develop`.
- В твоей директории не должно быть иных файлов, кроме тех, что обозначены в заданиях. 
- На пути к мастерству в сфере кибербезопасности ты получаешь возможность быть частью поддерживающего и вдохновляющего сообщества «Школы 21» по Кибербезопасности. Присоединяйся к [RocketChat](https://rocketchat-student.21-school.ru/channel/cybersec_21), чтобы получать свежие анонсы от сообщества, а также вступай в [Telegram](https://t.me/+r5wufz8L3mUzOGUy) для коммуникации.

Дисклеймер: 
- В целях геймификации обучения проект подается в формате истории, чтобы у тебя была возможность отвлечься от сложных заданий и тонны теории в гугле. Если придуманная история кажется тебе бесталанной и скучной, можно указать на это в обратной связи, чтобы автор поплакал над своим писательским навыком. Также можно пропускать введение в каждом задании и фокусироваться только на содержательной части.

## Chapter II
### Прикладные протоколы
Продолжаем знакомиться с основами компьютерных сетей. Перед тем как приступать к практическим действиям, необходимо изучить основные прикладные протоколы, без которых практически ни одна компьютерная сеть не может существовать. В заданиях приведены ссылки на статьи для ознакомления, но их мы рекомендуем рассматривать как дополнительный материал к самостоятельно изучаемому теоретическому материалу по сетям.

Основная работа будет проходить в среде эмуляции GNS3 и ПО для анализа сетевого трафика Wireshark.

**Важно**: при выполнении заданий не забывай сохранять конфигурации устройств.

## Chapter III
### Задание 1. Статическая маршрутизация
Для решения данного задания нужны знания в следующих темах: IP-адреса, 3 уровень OSI, GNS3, Wireshark.

>Пока Николай досматривал 4-й сезон «Игры престолов», к нему в окно прилетел снежок. Сначала он даже не обратил на это внимания, но на второй, а потом и третий раз игнорировать такое варварство стало невозможно. Он выглянул в окно и увидел мальчика, которому, по всей видимости, стало скучно играть в одиночестве, и он начал кидать снежки в окна дома, чтобы вызвать хоть какую-то реакцию у жильцов. Вопреки надежде Николая, хмурый взгляд не помог прогнать юного хулигана, поэтому пришлось начать диалог.
>
>— Чего тебе надо? — спросил экс-Дед Мороз.
>
>— Поиграть. Новый год ведь скоро, — ответил мальчик.
>
>— Нового года не будет, можешь идти домой, — отрезал Николай.
>
>— Почему? — с недоумением спросил мальчик, будто оскорбленный этим заявлением.
>
>— Дед Мороз на пенсии, мальчик, подарков не будет.
>
>После этих слов мальчик подошел поближе к окну, благо жил Николай на первом этаже.
>
>— А я могу помочь Деду Морозу, чтобы Новый год все-таки состоялся?
>
>Николай был настроен на решительный отказ, но в эту самую секунду в его голове промелькнула мысль, что запасы еды подходят к концу и пора бы сходить в магазин. А мальчика можно использовать как бесплатного носильщика пакетов.
>
>— Можешь, конечно. Пойдем, нам надо в магазин за подарками. Я покажу дорогу, — с ехидной улыбкой ответил Николай.


Маршрутизация — процесс определения оптимального пути прохождения IP-пакета. Может быть статической и динамической. Динамическую разберем в следующем проекте на примере OSPF и BGP.

Статья по теме: https://habr.com/ru/articles/140552/.

Без маршрутизации сетевое оборудование попросту не будет «знать», куда им отправлять пакеты. Статическая маршрутизация — это когда в сетевом оборудовании сетевой администратор собственными руками прописывает IP-адреса сетевого оборудования. Конечно же, этот способ эффективен, только когда в сети находится до 10 устройств. В крупных компаниях всё делается динамически.

Твое задание:

1. Для того чтобы освоить принципы работы статической маршрутизации, создай новый проект GNS3, добавь в него три сетевых устройства (используй образ Cisco 3745), для удобства назовем их R1, R2 и R3. Соедини их между собой так, чтобы они образовывали «цепочку» (R1-R2-R3).

2. Настрой сетевые интерфейсы, которыми соединены R1 и R2, используя адресацию из сети 10.10.10.0/24. Интерфейсы, которыми соединены R2 и R3, настрой, используя адресацию из другой сети с маской /24.

    Совет:
    - не назначай сетевым интерфейсам новых узлов «сложных» IP-адресов, используй простые, например, адресацию из сетей 10.10.10.0/24 и 10.10.20.0/24.
    
3. Сконфигурируй статические маршруты на устройстве R1 до сети между R2 и R3 и ответный маршрут на устройстве R3 до сети между R1 и R2.

4. Запусти сбор пакетной трассы, выполни команду ping до IP-интерфейса противоположного устройства (от R1 к R3 или наоборот), убедись в наличии ответного трафика. 

5. В Wireshark изучи пакетную трассу и сохрани результирующий pcap-файл с именем «static».

В итоге загрузи в репозиторий два файла: проект с расширением .gns3 и pcap-файл с именем `static`. Дополнительно при выполнении этого задания рекомендуем самостоятельно изучить, каким образом определяется приоритет маршрута в таблице маршрутизации.

### Задание 2. NTP
Для решения данного задания нужны знания в следующих темах: NTP, Wireshark, GNS3.

>В магазине Николай начал всё чаще посматривать на часы — ему было важно успеть домой затемно. Пока мальчишка воодушевленно ходил за спасителем Нового года, сам новоиспечённый герой только и делал, что набирал полуфабрикаты и литры кока-колы. Вскоре отсутствие игрушек в корзине пошатнуло веру мальчика в то, что он участник больших событий, и вызвало пламенную речь.
>
>— Мы ведь не покупаем подарки, чем же мы помогаем тогда Деду Морозу? Я по-настоящему поверил в то, что мы идем помогать другим детям, хотел сделать что-то хорошее.
>
>На этих словах в его глазах появились слезы. Николая до глубины тронул альтруизм мальчика. Может, действительно смысл заключается в том, чтобы сделать праздник для других, и только тогда праздник автоматически придет к тебе? В детстве праздничное настроение создают родители и все окружающие, но как только человек вырастает, ему нужно брать ответственность за других на себя. А что может быть лучше, чем взять на себя обязательства и выполнить их?
>
>Взглянув на часы и сверив время, Николай ответил: 
>
>— Пойдем, мы еще успеем набрать подарки.


NTP — сетевой протокол для синхронизации данных по текущему времени между устройствами. Зачем вообще синхронизировать время? Для того чтобы на разных устройствах в сети, включая сетевое оборудование, был одинаковый формат времени. Иначе в оборудовании и в приложениях могут возникнуть ошибки, связанные с некорректным часовым поясом / задержкой в несколько сотен миллисекунд. Согласись, что если на устройстве настроено время 12:01:05.100, а к нему приходит пакет, в котором стоит метка времени 12:01:05.400, то это сообщение можно считать посланием из будущего. Но сетевое оборудование ничего не знает о путешествиях во времени, поэтому такая ситуация вызовет ошибку в обработке пакета.

Статья по теме: https://habr.com/ru/articles/536436/.

Твое задание:
1. Для рассмотрения принципов работы NTP сконфигурируй на одном из устройств NTP-сервер.

2. На втором устройстве задай заведомо неверные значения текущего времени, запусти сбор трассы, укажи в качестве NTP-сервера устройство с настроенной службой NTP-сервера.

3. Убедись в том, что время успешно синхронизировалось с NTP-сервером.

4. Открой Wireshark и изучи результирующий файл пакетной трассы.

5. Ответь на вопросы:
-  Какой протокол четвертого уровня (по OSI) используется для взаимодействия между ntp-клиентом и ntp-сервером, какие source и destination порты при этом используются?
- Проверь передаваемое в первом NTP-пакете значение Transmit timestamp, запиши его.

6. Ответы запиши в текстовый файл с именем `ntp`.

7. В Wireshark сохрани результирующий pcap-файл с именем `ntp`.

В итоге загрузи в репозиторий файл проекта с расширением .gns3, текстовый файл с ответами с именем `ntp`, pcap-файл с именем `ntp`.

### Задание 3. DNS
Для решения данного задания нужны знания в следующих темах: DNS, FQDN, loopback интерфейс, Wireshark, GNS3.

>Тележка двух коллег по подарочному бизнесу резко преобразилась. Там начали появляться куклы, пластмассовые машинки, книжки и фломастеры. Глаза мальчика горели белым пламенем от этих сокровищ, и он сметал полки, не обращая внимания на ценники. Николай понял, что нужно организовать мальчика, иначе его годовая зарплата испарится в этом празднике жизни.
>
>— Нам надо разделиться. Я напишу тебе список подарков и скажу, куда конкретно за ними идти. Собирай их и приноси ко мне в тележку. Так мы управимся до закрытия магазина.
>
>Мальчик одобрительно кивнул.

DNS — система доменных имен, позволяет узнать IP-адрес узла в сети на основании его известного имени (FQDN).

Статья по теме: https://habr.com/ru/articles/818147/.

Задание для рассмотрения принципов работы DNS:
1. Сконфигурируй на одном из устройств DNS-сервер, добавь в его конфигурации DNS-запись для сайта my.site. 

2. На соседнем устройстве настрой использование узла с включенной службой DNS в качестве DNS-сервера.

3. Запусти сбор трассы, выполни команду ping my.site, убедись в том, что имя разрешилось в IP-адрес.

    Подсказка: необходимо добавить loopback-интерфейс для корректного разрешения добавленного DNS-имени в IP.

4. Открой в Wireshark результирующий файл пакетной трассы, отфильтруй пакеты, используя фильтр «dns», и изучи содержимое пакетов. Обрати внимание на то, какие source- и destination-порты используются при DNS-запросах и ответах.

5. Ответь на вопрос:
    - Какие тип и класс запроса видны в DNS-запросе? Ответ запиши в текстовый файл с именем `dns`.

В Wireshark сохрани результирующий pcap-файл с именем `dns`.  
  
В качестве финального ответа загрузи в репозиторий 3 файла: проект gns3, текстовый файл с именем `dns`, pcap-файл с именем `dns`.

Дополнительно при выполнении этого задания рекомендуем изучить понятие иерархии DNS-серверов и типы ресурсных записей в DNS.

### Задание 4. DHCP
Для решения данного задания нужны знания в следующих темах: DHCP, IP-address pool, роутер, Round Robin алгоритм, GNS3, Wireshark.

>Шел уже второй час крестового похода по гипермаркету. Время подходило к закрытию, а ведь надо было еще все оплатить и каким-то образом доставить к дому. Николай применил все свои организаторские способности, чтобы заставить мальчика остановиться и наконец пойти к кассе. Вот только теперь им нужно вспоминать, где находятся кассы, и достаточно быстро до них добраться.

DHCP — dynamic host configuration protocol, позволяет динамически назначать устройству-клиенту IP-адрес.

Статья по теме: https://habr.com/ru/articles/825016/.

Перед решением ознакомься с понятием DHCP pool-ов, арендой (dhcp lease) адресов и алгоритмом Round Robin.

Задание:
1. Добавь в ранее созданный проект GNS3 объект виртуального ПК (vPC), подключи его к одному из устройств Cisco.

2. Настрой на Cisco интерфейс (с адресацией из сети 10.10.30.0/24), к которому подключен vPC, настрой DHCP-сервер на выдачу 50 IP-адресов из этой же сети.

3. Запусти сбор трассы, настрой на vPC получение IP по DHCP.

4. Выполни с vPC ping до IP-адреса устройства, к которому он подключен. 

5. В Wireshark ознакомься с содержимым DHCP- и ICMP-пакетов. Сохрани полученный дамп в файл dhcp.pcap.
6. Ответь на вопросы:
    - Что означает вывод «DORA IP …» при DHCP-запросе — каким DHCP-пакетам из пакетной трассы DORA соответствует?
    - На какой IP-адрес отправляется первый DHCP-пакет? 
    
Ответы запиши в текстовый файл с именем `dhcp`.

По итогу в твоем репозитории должны быть: файл проекта gns3, pcap дамп-трафика `dhcp.pcap`, текстовый файл с ответами на вопросы с именем `dhcp`.

### Задание 5. SSH
Для решения данного задания нужны знания в следующих темах: SSH, RSA-ключи, VTY, TCP-протокол, Wireshark, GNS3.

>После возвращения Николая к своей работе прошло уже два дня. Он обновил свой костюм, сделал грим, даже расчесал бороду и изрядно полысевшую прическу. Его маленький партнер уже ожидал на улице. Выйдя на улицу с мешком подарков, Дед Мороз сгрузил их в машину и подозвал мальчика к себе.
>
>— Я веду машину и дарю подарки, а ты говори, куда рулить. Будешь штурманом наших саней.
>
>Так началось их новогоднее турне по всем подъездам и домам, финалом которого, как ожидалось, станет праздник в огромном количестве семей. А всё благодаря одному снежку, запущенному в нужное окно.

SSH — secure shell, «защищенная оболочка», протокол, предназначенный для безопасного удаленного доступа к сетевым устройствам. Именно этим протоколом сетевой администратор, засучив рукава, решает проблемы на сетевом оборудовании.

Статья по теме: https://habr.com/ru/articles/802179/.

Выполни следующие задания для знакомства с SSH:
1. Настрой SSH на одном из устройств — в числе прочего необходима настройка VTY, создание пользователя, генерация RSA-ключей. 

2. Запусти сбор пакетной трассы, проверь доступность 22-го порта на соседнем устройстве утилитой telnet.

3. Выполни подключение на соседнее устройство по SSH с учетными данными созданного на первом шаге пользователя, после ввода пароля и успешного подключения выполни отключение командой exit. 

4. В Wireshark ознакомься с содержимым пакетов запроса telnet и ответного трафика, изучи структуру TCP-пакета, флаги в TCP и последовательность выполнения TCP-handshake.

Сохрани результирующий файл pcap Wireshark с именем `ssh`.

В качестве ответа приложи: файл проекта gns3, pcap-файл с именем `ssh`.

💡 Нажми [сюда](https://new.oprosso.net/p/4cb31ec3f47a4596bc758ea1861fb624), чтобы поделиться с нами обратной связью на этот проект. Это анонимно и поможет команде Продукта сделать твоё обучение лучше.
